<!--
CO_OP_TRANSLATOR_METADATA:
{
  "original_hash": "7622aa72f9e676e593339f5f694ecd7d",
  "translation_date": "2025-05-20T08:24:03+00:00",
  "source_file": "05-agentic-rag/README.md",
  "language_code": "ja"
}
-->
[![Agentic RAG](../../../translated_images/lesson-5-thumbnail.1bab9551989766fa0dbea97c250a68c41e0f36ed9b02d3aa8ee8fdcc62596981.ja.png)](https://youtu.be/WcjAARvdL7I?si=BCgwjwFb2yCkEhR9)

> _(上の画像をクリックすると、このレッスンの動画が視聴できます)_

# Agentic RAG

このレッスンでは、Agentic Retrieval-Augmented Generation（Agentic RAG）について包括的に解説します。Agentic RAGは、大規模言語モデル（LLM）が外部ソースから情報を取得しながら、自律的に次のステップを計画する新しいAIパラダイムです。静的な「取得してから読む」パターンとは異なり、Agentic RAGはツールや関数呼び出し、構造化された出力を交えた反復的なLLM呼び出しを特徴としています。システムは結果を評価し、クエリを洗練し、必要に応じて追加のツールを呼び出し、満足のいく解決策が得られるまでこのサイクルを繰り返します。

## はじめに

このレッスンで学ぶ内容は以下の通りです。

- **Agentic RAGの理解:** 大規模言語モデル（LLM）が外部データソースから情報を取得しつつ、自律的に次のステップを計画する新しいAIパラダイムについて学びます。
- **反復的なメーカー-チェッカー方式の把握:** ツールや関数呼び出し、構造化された出力を挟みながらLLMを反復的に呼び出すループの仕組みを理解し、正確性の向上や不正確なクエリの処理を学びます。
- **実用的な応用例の探索:** Agentic RAGが活躍するシナリオ、例えば正確性重視の環境、複雑なデータベース操作、長期的なワークフローなどを特定します。

## 学習目標

このレッスンを修了すると、以下のことが理解できるようになります。

- **Agentic RAGの理解:** LLMが外部データから情報を取得しつつ、自律的に次の行動を計画する新たなAIパラダイムについて学びます。
- **反復的なメーカー-チェッカー方式:** ツールや関数呼び出し、構造化出力を交えたLLMの反復呼び出しループの概念を把握し、正確性向上や不正なクエリの処理を理解します。
- **推論プロセスの所有:** システムが事前定義された経路に頼らず、自ら問題解決の方法を決定する能力を理解します。
- **ワークフロー:** エージェントモデルが市場動向レポートの取得、競合データの特定、内部販売指標の相関分析、知見の統合、戦略の評価を自律的に行う仕組みを理解します。
- **反復ループ、ツール統合、メモリ:** 状態とメモリを保持しながら繰り返し処理を行い、無駄なループを避けつつ判断を下す仕組みを学びます。
- **失敗モードの処理と自己修正:** 反復や再クエリ、診断ツールの活用、人間の監督に頼るなど、堅牢な自己修正メカニズムを探ります。
- **エージェンシーの限界:** ドメイン固有の自律性、インフラ依存性、ガードレールの尊重といったAgentic RAGの制約を理解します。
- **実用的なユースケースと価値:** 正確性重視の環境、複雑なデータベース操作、長期的なワークフローなど、Agentic RAGが活躍する場面を特定します。
- **ガバナンス、透明性、信頼:** 説明可能な推論、バイアス制御、人間の監督など、ガバナンスと透明性の重要性を学びます。

## Agentic RAGとは何か？

Agentic Retrieval-Augmented Generation（Agentic RAG）は、LLMが外部ソースから情報を取得しながら、自律的に次のステップを計画する新しいAIパラダイムです。静的な「取得してから読む」パターンとは異なり、Agentic RAGはツールや関数呼び出し、構造化された出力を挟みながら反復的にLLMを呼び出します。システムは結果を評価し、クエリを洗練し、必要に応じて追加のツールを呼び出し、満足のいく解決策が得られるまでこのサイクルを続けます。この反復的な「メーカー-チェッカー」方式により、正確性が向上し、不正確なクエリも処理でき、高品質な結果が保証されます。

システムは推論プロセスを自ら所有し、失敗したクエリを書き直し、異なる検索手法を選択し、Azure AI Searchのベクトル検索、SQLデータベース、カスタムAPIなど複数のツールを統合して最終回答を導きます。Agenticシステムの特徴は、この推論プロセスの所有能力にあります。従来のRAGは事前定義された経路に依存しますが、Agenticシステムは得られた情報の質に基づき自律的に手順を決定します。

## Agentic Retrieval-Augmented Generation（Agentic RAG）の定義

Agentic Retrieval-Augmented Generation（Agentic RAG）は、LLMが外部データソースから情報を取得するだけでなく、自律的に次のステップを計画する新しいAI開発のパラダイムです。静的な「取得してから読む」パターンや厳密にスクリプト化されたプロンプトシーケンスとは異なり、Agentic RAGはツールや関数呼び出し、構造化出力を挟んだ反復的なLLM呼び出しループを特徴とします。システムは得られた結果を逐次評価し、クエリの洗練を判断し、必要に応じて追加ツールを呼び出し、満足のいく解決策が得られるまでこのサイクルを続けます。

この反復的な「メーカー-チェッカー」方式は、正確性を高め、構造化データベース（例：NL2SQL）への不正確なクエリを処理し、バランスの取れた高品質な結果を保証するために設計されています。厳密に設計されたプロンプトチェーンに頼るのではなく、システムは自ら推論プロセスを所有します。失敗したクエリを書き直し、異なる検索方法を選択し、Azure AI Searchのベクトル検索、SQLデータベース、カスタムAPIなど複数のツールを統合して最終回答を導きます。これにより、過度に複雑なオーケストレーションフレームワークは不要となり、比較的単純な「LLM呼び出し → ツール使用 → LLM呼び出し → …」のループで洗練された堅牢な出力が得られます。

![Agentic RAG Core Loop](../../../translated_images/agentic-rag-core-loop.2224925a913fb3439f518bda61a40096ddf6aa432a11c9b5bba8d0d625e47b79.ja.png)

## 推論プロセスの所有

システムを「Agentic」と呼ぶ特徴は、推論プロセスを自ら所有する能力にあります。従来のRAGは、人間がモデルのために事前に取得すべき情報やタイミングを示すチェーン・オブ・ソートに依存することが多いです。
しかし真にAgenticなシステムは、問題へのアプローチ方法を内部で決定します。単にスクリプトを実行するのではなく、得られた情報の質に基づいて手順の順序を自律的に決めるのです。
例えば、製品発売戦略の作成を求められた場合、事前に全研究と意思決定ワークフローを示すプロンプトに頼るのではなく、Agenticモデルは独自に以下を決定します。

1. Bing Web Groundingを使って最新の市場動向レポートを取得する
2. Azure AI Searchを使って関連する競合データを特定する
3. Azure SQL Databaseを使って過去の内部販売指標を相関分析する
4. Azure OpenAI Serviceを介して知見を統合し、統一された戦略を構築する
5. 戦略のギャップや矛盾を評価し、必要に応じて再度情報取得を行う
これらのステップすべて—クエリの洗練、情報源の選択、納得のいく回答が得られるまでの反復—はモデル自身が決定し、人間が事前にスクリプト化するわけではありません。

## 反復ループ、ツール統合、メモリ

![Tool Integration Architecture](../../../translated_images/tool-integration.7b05a923e3278bf1fd2972faa228fb2ac725f166ed084362b031a24bffd26287.ja.png)

Agenticシステムはループ状のインタラクションパターンに依存しています。

- **初回呼び出し:** ユーザーの目標（ユーザープロンプト）がLLMに提示されます。
- **ツール呼び出し:** モデルが情報不足や曖昧な指示を検知した場合、ベクトルデータベースクエリ（例：Azure AI Searchのプライベートデータに対するハイブリッド検索）や構造化SQL呼び出しなどのツールや検索方法を選択して追加のコンテキストを取得します。
- **評価と洗練:** 返されたデータをレビューし、情報が十分かどうかを判断します。不十分な場合はクエリを洗練し、別のツールを試すか、アプローチを調整します。
- **満足するまで繰り返す:** モデルが最終的に明確で十分な証拠が揃ったと判断するまで、このサイクルを続けます。
- **メモリと状態管理:** システムはステップ間で状態とメモリを保持し、過去の試行や結果を記憶して無駄なループを避け、より良い判断を下します。

これにより、モデルは進化する理解を持つようになり、人間が絶えず介入したりプロンプトを再設計したりすることなく、複雑で多段階のタスクを遂行できます。

## 失敗モードの処理と自己修正

Agentic RAGの自律性には堅牢な自己修正メカニズムも含まれます。システムが行き詰まった場合—例えば無関係な文書を取得したり、不正確なクエリに遭遇したりした際には、以下のように対応します。

- **反復と再クエリ:** 低品質な回答を返す代わりに、新たな検索戦略を試みたり、データベースクエリを書き直したり、別のデータセットを参照したりします。
- **診断ツールの活用:** 推論過程のデバッグや取得データの正確性確認を支援する追加機能を呼び出すことがあります。Azure AI Tracingのようなツールは堅牢な可観測性と監視を可能にします。
- **人間の監督へのフォールバック:** 重要度が高い、または繰り返し失敗するシナリオでは、不確実性をフラグし、人間の指導を求めることがあります。人間が修正フィードバックを提供すると、モデルはそれを取り入れて以降の処理に活かします。

このような動的かつ反復的なアプローチにより、モデルは継続的に改善し、一度きりのシステムではなく、セッション中の誤りから学習するシステムとなります。

![Self Correction Mechanism](../../../translated_images/self-correction.3d42c31baf4a476bb89313cec58efb196b0e97959c04d7439cc23d27ef1242ac.ja.png)

## エージェンシーの境界

タスク内での自律性はあっても、Agentic RAGは汎用人工知能（AGI）とは異なります。Agenticな能力は、人間の開発者が提供したツール、データソース、ポリシーに限定されます。自分でツールを発明したり、設定されたドメインの枠を超えたりすることはできません。むしろ、手元のリソースを動的にオーケストレーションする点に優れています。
より高度なAIとの主な違いは以下の通りです。

1. **ドメイン固有の自律性:** Agentic RAGシステムは既知のドメイン内でユーザー定義の目標を達成することに注力し、クエリ書き換えやツール選択などの戦略で成果を向上させます。
2. **インフラ依存:** システムの能力は開発者が統合したツールとデータに依存し、人間の介入なしにこれらの境界を超えることはできません。
3. **ガードレールの尊重:** 倫理指針、コンプライアンス規則、ビジネスポリシーは非常に重要であり、エージェントの自由度は安全対策や監督機構によって常に制約されています（望ましいことですが）。

## 実用的なユースケースと価値

Agentic RAGは反復的な洗練と精度が求められる場面で特に有効です。

1. **正確性重視の環境:** コンプライアンスチェック、規制分析、法務調査などで、事実を繰り返し検証し複数の情報源を参照しながら、クエリを書き換えて十分に検証された回答を生成します。
2. **複雑なデータベース操作:** クエリが失敗しやすい構造化データの取り扱いで、Azure SQLやMicrosoft Fabric OneLakeを用いて自律的にクエリを洗練し、最終的にユーザーの意図に合致する取得を実現します。
3. **長期的なワークフロー:** 新しい情報が出るにつれてセッションが進化する場合、Agentic RAGは継続的にデータを取り込み、問題領域についての理解を深めながら戦略を変化させます。

## ガバナンス、透明性、信頼

これらのシステムが推論においてより自律的になるにつれ、ガバナンスと透明性が重要になります。

- **説明可能な推論:** モデルは行ったクエリ、参照した情報源、結論に至る推論ステップの監査トレイルを提供できます。Azure AI Content SafetyやAzure AI Tracing / GenAIOpsのようなツールは透明性の維持とリスク軽減に役立ちます。
- **バイアス制御とバランスの取れた取得:** 開発者はバランスの取れた代表的なデータソースを考慮するよう取得戦略を調整し、Azure Machine Learningを活用した高度なデータサイエンス組織向けのカスタムモデルで出力のバイアスや偏りを定期的に監査します。
- **人間の監督とコンプライアンス:** 高度に敏感なタスクでは人間のレビューが不可欠です。Agentic RAGは重要な判断における人間の判断を置き換えるのではなく、より十分に検証された選択肢を提供することで支援します。

行動の明確な記録を提供するツールが不可欠です。これがなければ多段階プロセスのデバッグは非常に困難になります。以下はLiteral AI（Chainlitの開発元）によるAgent実行例です。

![AgentRunExample](../../../translated_images/AgentRunExample.27e2df23ad898772d1b3e7a3e3cd4615378e10dfda87ae8f06b4748bf8eea97d.ja.png)

![AgentRunExample2](../../../translated_images/AgentRunExample2.c0e8c78b1f2540a641515e60035abcc6a9c5e3688bae143eb6c559dd37cdee9f.ja.png)

## まとめ

Agentic RAGは、AIシステムが複雑でデータ集約的なタスクを扱う方法の自然な進化を示しています。ループ状のインタラクションパターンを採用し、自律的にツールを選択し、クエリを洗練して高品質な結果を得るまで繰り返すことで、静的なプロンプト追従を超えた、より適応的でコンテキストに即した意思決定者へと進化しています。人間が定義したインフラや倫理ガイドラインに依存しつつも、これらのAgentic能力は企業やエンドユーザーにとってより豊かで動的、かつ有用な

**免責事項**:  
本書類はAI翻訳サービス[Co-op Translator](https://github.com/Azure/co-op-translator)を使用して翻訳されました。正確性には努めておりますが、自動翻訳には誤りや不正確な部分が含まれる可能性があります。原文の言語によるオリジナルの文書が正式な情報源とみなされるべきです。重要な情報については、専門の人間による翻訳を推奨します。本翻訳の使用により生じたいかなる誤解や誤訳についても、当方は責任を負いかねます。